<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Tax Recommendation</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #f6f9fc, #e9f2f9);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: #333;
    }
    .card {
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      padding: 25px;
    }
    .tip {
      background: #fff8e1;
      border-left: 4px solid #ffb300;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 10px;
      font-size: 0.95em;
    }
    .unused {
      background: #e3f2fd;
      border-left: 4px solid #0d6efd;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 10px;
      font-size: 0.95em;
    }
    .chart img {
      max-width: 100%;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .regime-card {
      border-radius: 12px;
      padding: 20px;
      color: white;
      font-weight: 600;
      font-size: 1.3rem;
      text-align: center;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .regime-old {
      background: #198754;
      border: 2px solid #145c32;
    }
    .regime-new {
      background: #0d6efd;
      border: 2px solid #084298;
    }
    .opt-section {
      background: #f8f9fa;
      border-left: 4px solid #6c757d;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-10 col-md-12">
        <div class="card">
          <h2 class="text-center mb-4">üìä Tax Recommendation</h2>

          <!-- Regime suggestion colored card -->
          {% if suggested_regime == 'old' %}
            <div class="regime-card regime-old">
              Recommended Regime: Old Regime ‚úÖ
            </div>
          {% elif suggested_regime == 'new' %}
            <div class="regime-card regime-new">
              Recommended Regime: New Regime ‚úÖ
            </div>
          {% endif %}

          <h4 class="mb-3">Summary</h4>
          <table class="table table-striped">
            <tr><th>Income</th><td>‚Çπ{{ income|int }}</td></tr>
            <tr><th>Age</th><td>{{ age }}</td></tr>
            <tr>
              <th>Claimed Deductions</th>
              <td>
                {% if deductions %}
                  <ul class="mb-0">
                  {% for k,v in deductions.items() %}
                    <li>{{ k }}: ‚Çπ{{ v }}</li>
                  {% endfor %}
                  </ul>
                {% else %}
                  ‚Çπ0
                {% endif %}
              </td>
            </tr>
            <tr><th>Total Deductions (incl. ‚Çπ50,000 standard)</th><td>‚Çπ{{ total_deductions }}</td></tr>
            <tr><th>Taxable Income (old)</th><td>‚Çπ{{ ti_old }}</td></tr>
            <tr><th>Taxable Income (new)</th><td>‚Çπ{{ ti_new }}</td></tr>
            <tr><th>Old Regime Tax</th><td>‚Çπ{{ old_tax|float | round(2) }}</td></tr>
            <tr><th>New Regime Tax</th><td>‚Çπ{{ new_tax|float | round(2) }}</td></tr>
            <tr><th>Suggested Regime</th><td><strong>{{ suggested_regime }}</strong></td></tr>
          </table>
          <p><strong>Your Tax Slab:</strong> {{ slab_info }}</p>

          <!-- Tips Section -->
          <h4 class="mt-4">üí° Tax-saving Tips</h4>
          {% if tips %}
            {% for s,g in tips %}
              <div class="tip">Invest ‚Çπ{{ g }} more in <strong>{{ s }}</strong> to save tax.</div>
            {% endfor %}
          {% else %}
            <div class="alert alert-success">No direct tips ‚Äî you‚Äôre already using your deductions well.</div>
          {% endif %}

          <!-- Unused deductions Section -->
          <h3>üìå Unused Deductions You Can Still Claim</h3>
          {% if unused %}
            {% for u in unused %}
              <div class="unused">You haven‚Äôt claimed <strong>{{ u }}</strong> deduction yet.</div>
            {% endfor %}
          {% else %}
            <p style="background:#e0f7fa; padding:10px; border-radius:5px;">
              üéâ You've already explored all major deduction options
            </p>
          {% endif %}

          <!-- Chart Section -->
          <div class="chart text-center mt-4">
            {% if chart_png %}
              <img src="data:image/png;base64,{{ chart_png }}" alt="Tax chart">
            {% else %}
              <div class="alert alert-warning">Chart not available.</div>
            {% endif %}
          </div>

          <!-- Optimization Results -->
          <h3 class="mt-5">‚öôÔ∏è Optimization Results</h3>

          {% if plan_astar %}
          <div class="opt-section">
            <h5>üîπ A* Optimized Plan</h5>
            <ul>
              {% for sec, amt in plan_astar %}
              <li><strong>{{ sec }}</strong>: ‚Çπ{{ "{:,}".format(amt) }}</li>
              {% endfor %}
            </ul>
            <p><strong>Tax after A* optimization:</strong> ‚Çπ{{ "{:,.1f}".format(tax_astar) }}</p>
            <p class="text-muted">A* used incremental search with heuristic = 5% of income to find the lowest-tax plan.</p>
          </div>
          {% else %}
            <p class="text-danger">No A* plan found.</p>
          {% endif %}

          {% if plan_ao %}
          <div class="opt-section">
            <h5>üîπ AO* Optimized Plan</h5>
            <ul>
              {% for sec, amt in plan_ao %}
              <li><strong>{{ sec }}</strong>: ‚Çπ{{ "{:,}".format(amt) }}</li>
              {% endfor %}
            </ul>
            <p><strong>Tax after AO* optimization:</strong> ‚Çπ{{ "{:,.1f}".format(tax_ao) }}</p>
            <p class="text-muted">AO* applied dependency rules and expanded optimal deductions accordingly.</p>
          </div>
          {% else %}
            <p class="text-danger">No AO* plan found.</p>
          {% endif %}

          <div class="text-center mt-4">
            <a href="{{ url_for('index') }}" class="btn btn-primary btn-lg">üîÑ Run Again</a>
          </div>
          <div class="text-center mt-4">
            <a href="{{ url_for('index') }}" class="btn btn-primary btn-lg">‚¨ÖÔ∏è Back to Home</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
